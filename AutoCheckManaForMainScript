local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local THRESHOLD = 0.05
local currentHumanoid = nil
local staminaBar = nil
local canAct = false  -- Ban ƒë·∫ßu kh√¥ng cho ph√©p h√†nh ƒë·ªông
local initialDelay = 30  -- Th·ªùi gian delay 30 gi√¢y khi b·∫Øt ƒë·∫ßu script

shared.autoCheckMana = shared.autoCheckMana or false -- Bi·∫øn b·∫≠t/t·∫Øt toggle

-- üîÅ H√†m reset nh√¢n v·∫≠t b·∫±ng c√°ch set Health = 0
local function resetCharacter()
    if currentHumanoid then
        currentHumanoid.Health = 0
    end
end

-- üîÅ G√°n l·∫°i nh√¢n v·∫≠t m·ªói khi respawn
local function setupCharacter(character)
    currentHumanoid = character:WaitForChild("Humanoid")
    staminaBar = player:WaitForChild("PlayerGui"):WaitForChild("UI"):WaitForChild("HUD"):WaitForChild("Bars"):WaitForChild("Stamina")
end

-- N·∫øu nh√¢n v·∫≠t ƒë√£ t·ªìn t·∫°i
if player.Character then
    setupCharacter(player.Character)
end

-- Khi nh√¢n v·∫≠t m·ªõi spawn l·∫°i
player.CharacterAdded:Connect(function(char)
    setupCharacter(char)
end)

-- ‚è≥ Delay 30 gi√¢y khi b·∫Øt ƒë·∫ßu
task.wait(initialDelay)
canAct = true

-- üîÑ Theo d√µi Stamina v√† reset khi c·∫ßn
RunService.RenderStepped:Connect(function()
    if shared.autoCheckMana then  -- Ch·ªâ ch·∫°y khi toggle b·∫≠t
        if currentHumanoid and staminaBar then
            local percent = staminaBar.Size.X.Scale
            if percent < THRESHOLD and currentHumanoid.Health > 0 and canAct then
                -- N·∫øu Stamina th·∫•p v√† c√≥ th·ªÉ reset
                resetCharacter()  -- G·ªçi h√†m reset b·∫±ng Health = 0
                canAct = false  -- T·∫Øt kh·∫£ nƒÉng h√†nh ƒë·ªông

                -- Ch·ªù 30 gi√¢y tr∆∞·ªõc khi reset l·∫ßn ti·∫øp theo
                task.wait(30)
                canAct = true
            end
        end
    end
end)
