if _G.AutoSpinThread then
    task.cancel(_G.AutoSpinThread)
    _G.AutoSpinThread = nil
end

local function isRare(fruitName)
    for _, v in pairs(_G.selectedFruitName or {}) do
        if string.lower(v) == string.lower(fruitName) then
            return true
        end
    end
    return false
end

_G.AutoSpinThread = task.spawn(function()
    while _G.autoSpinToggle do
        local args = {"FruitsHandler", "Spin", {}}
        local result = game:GetService("ReplicatedStorage"):WaitForChild("Replicator"):InvokeServer(unpack(args))
        print("Káº¿t quáº£ spin:", result)

        if result and isRare(result) then
            print("ðŸŽ¯ Gáº·p trÃ¡i cáº§n:", result)
            _G.autoSpinToggle = false

            -- ðŸ§  Táº¯t toggle trÃªn giao diá»‡n náº¿u cÃ³
            if _G.AutoSpinToggleUI and _G.AutoSpinToggleUI.Set then
                _G.AutoSpinToggleUI:Set(false)
            end

            break
        else
            print("Spin tiáº¿p...")
        end

        task.wait(3.5)
    end

    print("â›” Auto Spin Ä‘Ã£ dá»«ng.")
end)
